<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Learning Strides In Convolutional Neural Networks | Daekyung Kim</title> <meta name="author" content="Daekyung Kim"/> <meta name="description" content="DiffStride, the first downsampling layer with learnable strides."/> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>📟</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://dkdkkim.github.io/blog/2022/learning-strides/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="https://dkdkkim.github.io/"><span class="font-weight-bold">Daekyung</span> Kim</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">publications</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item dropdown "> <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">submenus</a> <div class="dropdown-menu dropdown-menu-right" aria-labelledby="navbarDropdown"> <a class="dropdown-item" href="/publications/">publications</a> <div class="dropdown-divider"></div> <a class="dropdown-item" href="/projects/">projects</a> </div> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Learning Strides In Convolutional Neural Networks</h1> <p class="post-meta">April 26, 2022</p> <p class="post-tags"> <a href="/blog/2022"> <i class="fas fa-calendar fa-sm"></i> 2022 </a>   ·   <a href="/blog/tag/review"> <i class="fas fa-hashtag fa-sm"></i> review</a>     ·   <a href="/blog/category/paper-review"> <i class="fas fa-tag fa-sm"></i> paper-review</a>   </p> </header> <article class="post-content"> <p>Model의 architecure를 결정하는 여러가지 hyperparameter들이 이전에는 search space등의 방법으로 최선의 조합을 찾았다면, 최근에는 AutoML 방식으로 hyperparameter들도 알고리즘을 통해 자동으로 최적화하는 트렌드이다. 하지만 일반적으로 AutoML은 큰 Resource를 요구하기 때문에 실질적으로 사용하지 못하는 개발자들이 많다. 이번에는 CNN 모델에서 stride를 learnable하게 하는 연구에 대한 논문인 ‘LEARNING STRIDES IN CONVOLUTIONAL NEURAL NETWORKS’을 리뷰하고자 한다. 본 연구는 ICLR 2022에 oral paper로 선정되었으며, stride만을 leanable 하게 하기 때문에 지나치게 많은 resource를 요구하지도 않는다.</p> <hr> <h2 id="problem"><strong>Problem</strong></h2> <p>CNN base 모델에서 downsampling layer를 디자인 함에 있어서 stride는 flexable하면서 매주 중요한 요소이다. 하지만 최선의 조합을 찾기 위해서는 cross-validation이나 archtecuture search 방식을 사용해야 한다. CNN model의 hyperparameter는 다양하기 때문에 stride까지 hyperparameter로 탐색하게 된다면 search space는 매우 커지게된다. 이는 downsampling layer의 개수가 많아질수록 기하급수적으로 문제가 커진다.</p> <div> <center><img src="../../../assets/img/stride01.png" alt="diffstride" width="60%" height="60%"></center> </div> <div class="caption"> <center>Hyperparametes of CNN model</center> </div> <hr> <h2 id="contribution"><strong>Contribution</strong></h2> <p>본 논문에서는 처음으로 제안하는 learnable stride 방법론을 제안하며 이를 ‘DiffStride’라고 명명하였다. 실제로 audio와 image classification task에 적용하였고 실험적으로 그 효과성을 입증하였다.</p> <div> <center><img src="../../../assets/img/stride02.png" alt="diffstride" width="50%" height="60%"></center> </div> <div class="caption"> <center>Comparison of resiudal block with and without DiffStride</center> </div> <hr> <h2 id="method"><strong>Method</strong></h2> <h3 id="spectral-pooling">Spectral pooling</h3> <p>DiffStride를 소개하기에 앞서 먼저 Spectral pooling 에 대한 이해가 필요하다. Spectral은 frequency domain에서 power spectrum과 noise간의 특성을 이용해 pooling을 하는 방식을 말한다. 첫번째 단계로 Image \(y\)를 Discrete Fourier Transform(DFT)를 이용하여 frequency domain의 \(\hat y\)으로 변환한다. 그리고 주파수가 낮은 영역을 중심으로 crop한 후 다시 Inverse DFT를 통해서 spatiotemporal signal \(\hat x\) 로 변환한다. 그러면 natural image의 power 기댓값이 통계적으로 저주파 영역에 대부분 밀집되어 있기 때문에 정보량 손실을 최소화하면서 영상의 크기를 감소시킬 수 있다.</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/stride03-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/stride03-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/stride03-1400.webp"></source> <img src="/assets/img/stride03.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/stride04-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/stride04-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/stride04-1400.webp"></source> <img src="/assets/img/stride04.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <div class="caption"> Examples and algorithm of spectral pooling </div> <h3 id="diffstride">DiffStride</h3> <p>DiffStride의 workflow는 아래의 figure와 같다.</p> <div> <center><img src="../../../assets/img/stride05.png" alt="diffstride" width="70%" height="60%"></center> </div> <div class="caption"> <center>DiffStride forward and backward pass</center> </div> <p>먼저 이미지 또는 feature map \(x\) 는 Fourier Transform \(\it F\) 에 의해 \(y\) 로 변환된다. 그리고 \(y\) 는 Stride parameter \(S\)로 부터 만들어진 \(mask\) 와 Elementwise product를 통해서 저주파 영역 값만 남게 된다. 남은 영역만 crop 한 \(y_{cropped}\) 를 다시 Inverse Fourier Transform 하여 \(\hat x\) 가 되며 이것이 최종 출력물이 된다. 여기까지가 forward flow 였고 backward flow를 보면 빨간색 점선으로 표시되어 있는 순서로 진행된다고 보면 된다. CNN을 학습하기 위한 flow는 기존과 마찬가지로 input image \(x\)까지 흘러가고, stride parameter \(S\)를 학습하기 위한 backward flow는 \(Crop\) 에서는 disconnect 되어 있으므로 element-wise product에서 분기하여 gradient가 계산된다.</p> <div> <center><img src="../../../assets/img/stride06.png" alt="diffstride" width="60%" height="60%"></center> </div> <div class="caption"> <center>Algorithm of DiffStride</center> </div> <hr> <h2 id="experimental-result"><strong>Experimental result</strong></h2> <p>논문에서는 image와 audio classification에서 실험을 진행했지만, image classification 에 대한 내용만 정리했다. Backbone은 resnet18로 setting 하였으며 CIFAR 10, CIFAR 100, ImageNet 에 대해서 training 및 evaluation을 진행하였다.</p> <p>Diffstride의 성능은 Vanilla resnet, Spectral pooling이 적용된 resnet과 initial stride 값에 따라 비교 하였다. 아래 표에서 보면 알 수 있듯이 정보 손실량이 적은 spectral pooling의 경우 일반적인 resnet보다 높은 성능을 보였으며, 대부분의 inital stride에 대해서 DiffStride가 적용된 경우가 Spectral pooling이 적용된 경우보다 더 높은 성능을 보이는 것을 알 수 있다.</p> <div> <center><img src="../../../assets/img/stride07.png" alt="diffstride" width="60%" height="60%"></center> </div> <div class="caption"> <center>Accuracies on CIFAR10 and CIFAR100</center> </div> <div> <center><img src="../../../assets/img/stride08.png" alt="diffstride" width="60%" height="60%"></center> </div> <div class="caption"> <center> Top-1 and top-5 accuracies (% ± sd over 3 runs) on Imagenet</center> </div> <p>Learnable Stride의 training 경향은 아래 그래프 (a) 에서 처럼 epoch 이 진행됨에 따라 특정 값으로 수렴하는 것을 알 수 있다. 그래프 (b)를 보면 layer의 depth에 따른 Stride의 수렴 값을 알 수 있는데 깊은 level의 layer 일수록 stride의 수렴값이 커지는 것을 알 수 있다. 그리고 그래프 (c) 에서는 width의 stride 값이 height의 stride 값보다 더 큰 값으로 수렴하는 것을 알 수 있다.</p> <hr> <h2 id="limitations"><strong>Limitations</strong></h2> <p>Spectral pooling의 경우 정보손실량을 줄인다는 점에서 이점이 있지만 그 과정에서 DFT와 Inverse-DFT의 연산과정이 추가되므로 Computational cost 가 증가한다는 한계점이 존재한다. DiffStride는 이에 더해서 Stride parameter를 learnable 하게 하는데에 더 많은 연산량을 요구하기 때문에, Peak Memory 관점에서는 최대 2배 가까운 메모리를 요구할 수도 있다. 이는 저자도 논문에서 언급한 바이다.</p> <div> <center><img src="../../../assets/img/stride09.png" alt="diffstride" width="60%" height="60%"></center> </div> <div class="caption"> <center>Per-step time and peak memory usage of Spectral Pooling and DiffStride</center> </div> <p>그리고 실험결과를 보면 일부 stride의 initial의 경우에는 DiffStride의 성능이 더 떨어지는 경우가 발생하는데 이는 layer depth가 더 많아지고 initial stride 의 경우의 수가 많아질때에는 intial stride 자체가 새로운 hyperparameter 가 되는 문제가 발생할 수도 있다고 개인적으로 생각한다.</p> <hr> <h2 id="reference">Reference</h2> <ul> <li><a href="https://arxiv.org/abs/2202.01653" target="_blank" rel="noopener noreferrer">Riad, Rachid, et al. “Learning strides in convolutional neural networks.” arXiv preprint arXiv:2202.01653 (2022).</a></li> <li><a href="https://proceedings.neurips.cc/paper/2015/hash/536a76f94cf7535158f66cfbd4b113b6-Abstract.html" target="_blank" rel="noopener noreferrer">Rippel, Oren, Jasper Snoek, and Ryan P. Adams. “Spectral representations for convolutional neural networks.” Advances in neural information processing systems 28 (2015).</a></li> </ul> </article> </div> </div> <footer class="fixed-bottom"> <div class="container mt-0"> © Copyright 2023 Daekyung Kim. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="noopener noreferrer">Unsplash</a>. Last updated: April 15, 2023. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>